<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug: Rich Text Editor Save Issue</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
        }
        .debug-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .problem {
            border-left: 4px solid #ef4444;
            background: #fef2f2;
            padding: 15px;
            margin: 10px 0;
        }
        .solution {
            border-left: 4px solid #10b981;
            background: #f0fdf4;
            padding: 15px;
            margin: 10px 0;
        }
        .code {
            background: #f6f8fa;
            font-family: 'Monaco', 'Consolas', monospace;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .highlight-issue {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 4px;
            padding: 2px 4px;
        }
        .highlight-fix {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 4px;
            padding: 2px 4px;
        }
    </style>
</head>
<body>
    <h1>üîç Diagn√≥stico: Rich Text Editor Save Issue</h1>
    
    <div class="debug-section">
        <h2>üö® Problema Identificado</h2>
        <div class="problem">
            <strong>Issue:</strong> Los cambios hechos en el rich text editor no se guardan
            <br><br>
            <strong>Root Cause:</strong> L√≥gica incorrecta en handleSave() - siempre prioriza generatedContent sobre contentEditorState
        </div>
        
        <h3>C√≥digo Problem√°tico (ContentForm.tsx l√≠neas 191-203):</h3>
        <div class="code">
const handleSave = useCallback(async () => {
  if (!generatedContent && !contentEditorState) {
    alert('No hay contenido generado para guardar')
    return
  }
  
  setIsSaving(true)
  try {
    // Convert editor state to HTML if the content was edited
    let contentToSave = <span class="highlight-issue">generatedContent</span>
    if (contentEditorState) {
      contentToSave = serializedStateToHtml(contentEditorState)
    }
        </div>
        
        <h3>An√°lisis del Flujo Problem√°tico:</h3>
        <ol>
            <li><strong>Estado Inicial:</strong> Despu√©s de generar contenido
                <ul>
                    <li>generatedContent = "HTML original generado"</li>
                    <li>contentEditorState = undefined</li>
                </ul>
            </li>
            <li><strong>Usuario Edita:</strong> handleContentEditorChange se ejecuta
                <ul>
                    <li>generatedContent = "HTML original generado" <em>(sin cambios)</em></li>
                    <li>contentEditorState = {nuevo estado con cambios}</li>
                </ul>
            </li>
            <li><strong>Usuario Guarda:</strong> handleSave se ejecuta
                <ul>
                    <li>contentToSave = generatedContent <em>(contenido original, ignora cambios)</em></li>
                    <li>La condici√≥n if (contentEditorState) nunca se ejecuta porque generatedContent existe</li>
                </ul>
            </li>
        </ol>
    </div>

    <div class="debug-section">
        <h2>‚úÖ Soluci√≥n Propuesta</h2>
        <div class="solution">
            <strong>Fix:</strong> Cambiar la l√≥gica para priorizar contentEditorState cuando existe (indicando que el usuario ha editado)
        </div>
        
        <h3>C√≥digo Corregido:</h3>
        <div class="code">
const handleSave = useCallback(async () => {
  if (!generatedContent && !contentEditorState) {
    alert('No hay contenido generado para guardar')
    return
  }
  
  setIsSaving(true)
  try {
    // FIXED: Prioritize editor state if user has made edits
    let contentToSave: string
    if (<span class="highlight-fix">contentEditorState</span>) {
      // User has edited - use the current editor state
      contentToSave = serializedStateToHtml(contentEditorState)
    } else {
      // No edits made - use original generated content
      contentToSave = generatedContent
    }
        </div>
        
        <h3>Flujo Corregido:</h3>
        <ol>
            <li><strong>Estado Inicial:</strong> Despu√©s de generar contenido
                <ul>
                    <li>generatedContent = "HTML original generado"</li>
                    <li>contentEditorState = undefined</li>
                    <li>‚Üí Guarda: generatedContent</li>
                </ul>
            </li>
            <li><strong>Usuario Edita:</strong> handleContentEditorChange se ejecuta
                <ul>
                    <li>generatedContent = "HTML original generado"</li>
                    <li>contentEditorState = {nuevo estado con cambios}</li>
                </ul>
            </li>
            <li><strong>Usuario Guarda:</strong> handleSave se ejecuta
                <ul>
                    <li>contentToSave = serializedStateToHtml(contentEditorState) <em>(usa cambios del usuario)</em></li>
                    <li>‚úÖ Los cambios se guardan correctamente</li>
                </ul>
            </li>
        </ol>
    </div>

    <div class="debug-section">
        <h2>üîß Implementaci√≥n</h2>
        <p>La correcci√≥n requiere:</p>
        <ol>
            <li>Cambiar la l√≥gica de prioridad en handleSave()</li>
            <li>Asegurar que contentEditorState se actualiza correctamente (ya funciona)</li>
            <li>Verificar que serializedStateToHtml() funciona correctamente (ya funciona)</li>
        </ol>
        
        <div class="solution">
            <strong>Status:</strong> ‚úÖ Issue identificado y soluci√≥n preparada
            <br>
            <strong>Action:</strong> Aplicar el fix al archivo ContentForm.tsx
        </div>
    </div>
</body>
</html>